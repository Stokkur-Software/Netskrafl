
{% extends "container.html" %}

{% block opengraph %}

<meta property="og:locale" content="is_IS" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Netskrafl" />
<meta property="og:description" content="Spilaðu skrafl á netinu" />
<meta property="og:image" content="{{ url_for('static', filename='NetskraflFacebookImageSq.jpg', _external=True) | safe }}" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="600" />
<meta property="og:image:height" content="600" />

<!-- Google OAuth sign-in -->
<meta name="google-signin-client_id" content="62474854399-j186rtbl9hbh6c6o21or405o6clbcj84.apps.googleusercontent.com">

{% endblock %}

{% block startscripts %}
<!-- include 'firebase.html' -->
<!-- include 'firebase-auth.html' -->
{% endblock %}

{% block scripts %}
{% endblock %}

{% block logo %}
{% include 'logo.html' %}
{% endblock %}

{% block content %}

<div class="loginform-large">
   <!-- Large UI form -->
   <div class="loginhdr">
      Velkomin í Netskrafl!
   </div>
   <div class="blurb">
      Skemmtilegt | skerpandi | ókeypis
   </div>
   <div id="board-pic"><img src="{{ url_for('static', filename='Board.png') }}" width="310" height="300"></div>
   <div class="welcome">
      Netskrafl er vettvangur <b>yfir 16.000 íslenskra skraflara</b> á netinu.
   </div>
   <div class="welcome">
      Netskrafl notar Google Accounts innskráningu, þá
      sömu og er notuð m.a. í Gmail.
   </div>
   <div class="welcome">
      Netskrafl safnar hvorki persónuupplýsingum né geymir þær.
   </div>
   <div class="welcome">
      Þú getur alltaf
      fengið <a href="{{ url_for('help') }}">hjálp</a> með því að
      smella á <a href="{{ url_for('help') }}">bláa&nbsp;&nbsp;<span class="glyphicon glyphicon-info-sign"></span> - merkið</a>
      hér til vinstri.
   </div>
   <div style="float:right">
      <div class="g-signin2" data-onsuccess="onSignIn"></div>
   </div>
</div>

<div class="loginform-small">
   <!-- Small UI form -->
   <div id="logo-pic">
      <img src="{{ url_for('static', filename='LoginLogo600.png') }}" width="300" height="300">
   </div>
   <div class="blurb">
      Skemmtilegt | skerpandi | ókeypis
   </div>
   <div style="text-align: center">
      <div class="g-signin2" data-onsuccess="onSignIn"></div>
   </div>
</div>

{% endblock %}

{% block endscripts %}

<script>

function getCookie(name) {
   var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
   return v ? v[2] : null;
}

function oauth2callback(idToken, csrfToken) {
   // POST to oauth2 session login endpoint
   return $.ajax(
      {
         type: 'POST',
         url: "/oauth2callback",
         data: {
            idToken: idToken,
            csrfToken: csrfToken,
         }
      }
   );
}

function onSignIn(googleUser) {
   var idToken = googleUser.getAuthResponse().id_token;
   var profile = googleUser.getBasicProfile();
   var id = profile.getId();
   var name = profile.getName();
   var email = profile.getEmail();
   console.log('ID: ' + id);
   console.log('Name: ' + name);
   console.log('Email: ' + email);
   console.log("ID Token: " + idToken);
   // Session login endpoint is queried and the session cookie is set.
   // CSRF token should be sent along with request.
   var csrfToken = getCookie('csrfToken');
   oauth2callback(idToken, csrfToken)
      .then(
         function() {
            // Redirect to initial URL on success
            window.location.assign("{{ main_url | safe }}");
         },
         function(error) {
            // Refresh page on error.
            // In all cases, client side state should be lost due to in-memory
            // persistence.
            console.log("Error from oauth2callback(): " + error);
            window.location.assign('/login');
         }
      );
}

function initMain() {
/*
   gapi.load('auth2',
      function() {
         auth2 = gapi.auth2.init(
            {
               client_id: 'CLIENT_ID.apps.googleusercontent.com',
               fetch_basic_profile: false,
               scope: 'profile'
            }
         );
         // Sign the user in, and then retrieve their ID.
         auth2.signIn().then(
            function() {
               console.log(auth2.currentUser.get().getId());
            }
         );
      }
   );
*/
}

$(document).ready(initMain);

</script>

{% endblock %}
